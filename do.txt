2) Set up a deploy key on the Pi (read-only)

On the Pi:

sudo adduser --disabled-password --gecos "" site-deploy
sudo mkdir -p /opt/site-repo /var/www/emotional-toys
sudo chown -R site-deploy:site-deploy /opt/site-repo
sudo chown -R www-data:www-data /var/www/emotional-toys


Create an SSH key for pulling the repo:

sudo -u site-deploy ssh-keygen -t ed25519 -C "pi-site-deploy" -f /home/site-deploy/.ssh/id_ed25519 -N ""
sudo -u site-deploy cat /home/site-deploy/.ssh/id_ed25519.pub


Add that public key to your Git provider as a Deploy Key (read-only).

3) Clone the repo on the Pi

As site-deploy:

sudo -u site-deploy git clone git@github.com:YOURORG/YOURREPO.git /opt/site-repo


(Use your repo SSH URL.)

4) Create a deploy script (atomic copy into web root)

Create:

sudo nano /usr/local/bin/deploy-site


Paste:

#!/usr/bin/env bash
set -euo pipefail

REPO_DIR="/opt/site-repo"
WEB_ROOT="/var/www/emotional-toys"

cd "$REPO_DIR"

# Pull latest
git fetch origin main
git reset --hard origin/main

# Sync into web root (atomic-ish: copy then replace)
rsync -a --delete \
  --exclude ".git/" \
  "$REPO_DIR"/ \
  "$WEB_ROOT"/

# Ensure permissions for nginx
chown -R www-data:www-data "$WEB_ROOT"
find "$WEB_ROOT" -type d -exec chmod 755 {} \;
find "$WEB_ROOT" -type f -exec chmod 644 {} \;

# Reload nginx (safe even if not strictly required for static)
systemctl reload nginx


Make it executable:

sudo chmod 755 /usr/local/bin/deploy-site


Allow the site-deploy user to reload nginx and write to the web root without full sudo access:

sudo visudo -f /etc/sudoers.d/site-deploy


Add:

site-deploy ALL=NOPASSWD: /bin/systemctl reload nginx
site-deploy ALL=NOPASSWD: /usr/bin/rsync, /bin/chown, /usr/bin/find


Also ensure site-deploy can write to the web root by letting rsync run as root via sudo (simplest), or by making site-deploy the owner of /var/www/emotional-toys. The cleanest approach is to run the script as root via systemd; see next step.

5) Run deploy via systemd service + timer

Create service:

sudo nano /etc/systemd/system/deploy-site.service


Paste:

[Unit]
Description=Deploy website from git to nginx web root
After=network-online.target
Wants=network-online.target

[Service]
Type=oneshot
User=root
ExecStart=/usr/local/bin/deploy-site


Create timer:

sudo nano /etc/systemd/system/deploy-site.timer


Paste:

[Unit]
Description=Run website deploy periodically

[Timer]
OnBootSec=30
OnUnitActiveSec=60
AccuracySec=10

[Install]
WantedBy=timers.target


Enable:

sudo systemctl daemon-reload
sudo systemctl enable --now deploy-site.timer


Test immediately:

sudo systemctl start deploy-site.service
sudo systemctl status deploy-site.service --no-pager


From now on, pushing to main will deploy within ~60 seconds.